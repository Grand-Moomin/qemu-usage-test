#include "kernel/loader.h"

isr_entry:
    pushl %eax
	pushl %ebx
	pushl %ecx
	pushl %edx
	pushl %esi
	pushl %edi
	pushl %ebp
	pushw %ds
	pushw %es
	pushw %fs
	pushw %gs
	mov $SEL_KDSEG, %ax
	mov %ax, %ds
	mov %ax, %es
	mov %ax, %fs
	mov %ax, %gs
    pushl %esp
    call generic_isr    # Generic interrupt service routine in 'interrupt.c'
    add $4, %esp

isr_exit:
    popw %gs
	popw %fs
	popw %es
	popw %ds
	popl %ebp
	popl %edi
	popl %esi
	popl %edx
	popl %ecx
	popl %ebx
	popl %eax
    add $8, %esp # Pop vec_no and a pseudo error code 0 or a real error code.
    iret
    
#define NO_ERROR_CODE_ENTRY(vec_no) \
    .text           ;\
.func isr_stub##vec_no  ;\
isr_stub##vec_no:   \
    pushl $0        ;\
    pushl $0x##vec_no    ;\
    jmp isr_entry   ;\
.endfunc            ;\
    .data           ;\
    .long isr_stub##vec_no  ;

#define ERROR_CODE_ENTRY(vec_no)    \
    .text           ;\
.func isr_stub##vec_no  ;\
isr_stub##vec_no:   ;\
    pushl $0x##vec_no    ;\
    jmp isr_entry   ;\
.endfunc            ;\
    .data           ;\
    .long isr_stub##vec_no ;


    .data

.globl isr_stubs
isr_stubs:
    NO_ERROR_CODE_ENTRY(00)
    NO_ERROR_CODE_ENTRY(01)
    NO_ERROR_CODE_ENTRY(02)
    NO_ERROR_CODE_ENTRY(03)
    NO_ERROR_CODE_ENTRY(04)
    NO_ERROR_CODE_ENTRY(05)
    NO_ERROR_CODE_ENTRY(06)
    NO_ERROR_CODE_ENTRY(07)
    ERROR_CODE_ENTRY(08)
    NO_ERROR_CODE_ENTRY(09)
    ERROR_CODE_ENTRY(0a)
    ERROR_CODE_ENTRY(0b)
    NO_ERROR_CODE_ENTRY(0c)
    ERROR_CODE_ENTRY(0d)
    ERROR_CODE_ENTRY(0e)
    NO_ERROR_CODE_ENTRY(0f)

    NO_ERROR_CODE_ENTRY(10)
    ERROR_CODE_ENTRY(11)
    NO_ERROR_CODE_ENTRY(12)
    NO_ERROR_CODE_ENTRY(13)
    NO_ERROR_CODE_ENTRY(14)
    NO_ERROR_CODE_ENTRY(15)
    NO_ERROR_CODE_ENTRY(16)
    NO_ERROR_CODE_ENTRY(17)
    NO_ERROR_CODE_ENTRY(18)
    NO_ERROR_CODE_ENTRY(19)
    NO_ERROR_CODE_ENTRY(1a)
    NO_ERROR_CODE_ENTRY(1b)
    NO_ERROR_CODE_ENTRY(1c)
    NO_ERROR_CODE_ENTRY(1d)
    NO_ERROR_CODE_ENTRY(1e)
    NO_ERROR_CODE_ENTRY(1f)

    NO_ERROR_CODE_ENTRY(20)
    NO_ERROR_CODE_ENTRY(21)
    NO_ERROR_CODE_ENTRY(22)
    NO_ERROR_CODE_ENTRY(23)
    NO_ERROR_CODE_ENTRY(24)
    NO_ERROR_CODE_ENTRY(25)
    NO_ERROR_CODE_ENTRY(26)
    NO_ERROR_CODE_ENTRY(27)
    NO_ERROR_CODE_ENTRY(28)
    NO_ERROR_CODE_ENTRY(29)
    NO_ERROR_CODE_ENTRY(2a)
    NO_ERROR_CODE_ENTRY(2b)
    NO_ERROR_CODE_ENTRY(2c)
    NO_ERROR_CODE_ENTRY(2d)
    NO_ERROR_CODE_ENTRY(2e)
    NO_ERROR_CODE_ENTRY(2f)

    NO_ERROR_CODE_ENTRY(30)
    NO_ERROR_CODE_ENTRY(31)
    NO_ERROR_CODE_ENTRY(32)
    NO_ERROR_CODE_ENTRY(33)
    NO_ERROR_CODE_ENTRY(34)
    NO_ERROR_CODE_ENTRY(35)
    NO_ERROR_CODE_ENTRY(36)
    NO_ERROR_CODE_ENTRY(37)
    NO_ERROR_CODE_ENTRY(38)
    NO_ERROR_CODE_ENTRY(39)
    NO_ERROR_CODE_ENTRY(3a)
    NO_ERROR_CODE_ENTRY(3b)
    NO_ERROR_CODE_ENTRY(3c)
    NO_ERROR_CODE_ENTRY(3d)
    NO_ERROR_CODE_ENTRY(3e)
    NO_ERROR_CODE_ENTRY(3f)
    
    NO_ERROR_CODE_ENTRY(40)
    NO_ERROR_CODE_ENTRY(41)
    NO_ERROR_CODE_ENTRY(42)
    NO_ERROR_CODE_ENTRY(43)
    NO_ERROR_CODE_ENTRY(44)
    NO_ERROR_CODE_ENTRY(45)
    NO_ERROR_CODE_ENTRY(46)
    NO_ERROR_CODE_ENTRY(47)
    NO_ERROR_CODE_ENTRY(48)
    NO_ERROR_CODE_ENTRY(49)
    NO_ERROR_CODE_ENTRY(4a)
    NO_ERROR_CODE_ENTRY(4b)
    NO_ERROR_CODE_ENTRY(4c)
    NO_ERROR_CODE_ENTRY(4d)
    NO_ERROR_CODE_ENTRY(4e)
    NO_ERROR_CODE_ENTRY(4f)

    NO_ERROR_CODE_ENTRY(50)
    NO_ERROR_CODE_ENTRY(51)
    NO_ERROR_CODE_ENTRY(52)
    NO_ERROR_CODE_ENTRY(53)
    NO_ERROR_CODE_ENTRY(54)
    NO_ERROR_CODE_ENTRY(55)
    NO_ERROR_CODE_ENTRY(56)
    NO_ERROR_CODE_ENTRY(57)
    NO_ERROR_CODE_ENTRY(58)
    NO_ERROR_CODE_ENTRY(59)
    NO_ERROR_CODE_ENTRY(5a)
    NO_ERROR_CODE_ENTRY(5b)
    NO_ERROR_CODE_ENTRY(5c)
    NO_ERROR_CODE_ENTRY(5d)
    NO_ERROR_CODE_ENTRY(5e)
    NO_ERROR_CODE_ENTRY(5f)

    NO_ERROR_CODE_ENTRY(60)
    NO_ERROR_CODE_ENTRY(61)
    NO_ERROR_CODE_ENTRY(62)
    NO_ERROR_CODE_ENTRY(63)
    NO_ERROR_CODE_ENTRY(64)
    NO_ERROR_CODE_ENTRY(65)
    NO_ERROR_CODE_ENTRY(66)
    NO_ERROR_CODE_ENTRY(67)
    NO_ERROR_CODE_ENTRY(68)
    NO_ERROR_CODE_ENTRY(69)
    NO_ERROR_CODE_ENTRY(6a)
    NO_ERROR_CODE_ENTRY(6b)
    NO_ERROR_CODE_ENTRY(6c)
    NO_ERROR_CODE_ENTRY(6d)
    NO_ERROR_CODE_ENTRY(6e)
    NO_ERROR_CODE_ENTRY(6f)

    NO_ERROR_CODE_ENTRY(70)
    NO_ERROR_CODE_ENTRY(71)
    NO_ERROR_CODE_ENTRY(72)
    NO_ERROR_CODE_ENTRY(73)
    NO_ERROR_CODE_ENTRY(74)
    NO_ERROR_CODE_ENTRY(75)
    NO_ERROR_CODE_ENTRY(76)
    NO_ERROR_CODE_ENTRY(77)
    NO_ERROR_CODE_ENTRY(78)
    NO_ERROR_CODE_ENTRY(79)
    NO_ERROR_CODE_ENTRY(7a)
    NO_ERROR_CODE_ENTRY(7b)
    NO_ERROR_CODE_ENTRY(7c)
    NO_ERROR_CODE_ENTRY(7d)
    NO_ERROR_CODE_ENTRY(7e)
    NO_ERROR_CODE_ENTRY(7f)

    NO_ERROR_CODE_ENTRY(80)
    NO_ERROR_CODE_ENTRY(81)
    NO_ERROR_CODE_ENTRY(82)
    NO_ERROR_CODE_ENTRY(83)
    NO_ERROR_CODE_ENTRY(84)
    NO_ERROR_CODE_ENTRY(85)
    NO_ERROR_CODE_ENTRY(86)
    NO_ERROR_CODE_ENTRY(87)
    NO_ERROR_CODE_ENTRY(88)
    NO_ERROR_CODE_ENTRY(89)
    NO_ERROR_CODE_ENTRY(8a)
    NO_ERROR_CODE_ENTRY(8b)
    NO_ERROR_CODE_ENTRY(8c)
    NO_ERROR_CODE_ENTRY(8d)
    NO_ERROR_CODE_ENTRY(8e)
    NO_ERROR_CODE_ENTRY(8f)

    NO_ERROR_CODE_ENTRY(90)
    NO_ERROR_CODE_ENTRY(91)
    NO_ERROR_CODE_ENTRY(92)
    NO_ERROR_CODE_ENTRY(93)
    NO_ERROR_CODE_ENTRY(94)
    NO_ERROR_CODE_ENTRY(95)
    NO_ERROR_CODE_ENTRY(96)
    NO_ERROR_CODE_ENTRY(97)
    NO_ERROR_CODE_ENTRY(98)
    NO_ERROR_CODE_ENTRY(99)
    NO_ERROR_CODE_ENTRY(9a)
    NO_ERROR_CODE_ENTRY(9b)
    NO_ERROR_CODE_ENTRY(9c)
    NO_ERROR_CODE_ENTRY(9d)
    NO_ERROR_CODE_ENTRY(9e)
    NO_ERROR_CODE_ENTRY(9f)

    NO_ERROR_CODE_ENTRY(a0)
    NO_ERROR_CODE_ENTRY(a1)
    NO_ERROR_CODE_ENTRY(a2)
    NO_ERROR_CODE_ENTRY(a3)
    NO_ERROR_CODE_ENTRY(a4)
    NO_ERROR_CODE_ENTRY(a5)
    NO_ERROR_CODE_ENTRY(a6)
    NO_ERROR_CODE_ENTRY(a7)
    NO_ERROR_CODE_ENTRY(a8)
    NO_ERROR_CODE_ENTRY(a9)
    NO_ERROR_CODE_ENTRY(aa)
    NO_ERROR_CODE_ENTRY(ab)
    NO_ERROR_CODE_ENTRY(ac)
    NO_ERROR_CODE_ENTRY(ad)
    NO_ERROR_CODE_ENTRY(ae)
    NO_ERROR_CODE_ENTRY(af)

    NO_ERROR_CODE_ENTRY(b0)
    NO_ERROR_CODE_ENTRY(b1)
    NO_ERROR_CODE_ENTRY(b2)
    NO_ERROR_CODE_ENTRY(b3)
    NO_ERROR_CODE_ENTRY(b4)
    NO_ERROR_CODE_ENTRY(b5)
    NO_ERROR_CODE_ENTRY(b6)
    NO_ERROR_CODE_ENTRY(b7)
    NO_ERROR_CODE_ENTRY(b8)
    NO_ERROR_CODE_ENTRY(b9)
    NO_ERROR_CODE_ENTRY(ba)
    NO_ERROR_CODE_ENTRY(bb)
    NO_ERROR_CODE_ENTRY(bc)
    NO_ERROR_CODE_ENTRY(bd)
    NO_ERROR_CODE_ENTRY(be)
    NO_ERROR_CODE_ENTRY(bf)

    NO_ERROR_CODE_ENTRY(c0)
    NO_ERROR_CODE_ENTRY(c1)
    NO_ERROR_CODE_ENTRY(c2)
    NO_ERROR_CODE_ENTRY(c3)
    NO_ERROR_CODE_ENTRY(c4)
    NO_ERROR_CODE_ENTRY(c5)
    NO_ERROR_CODE_ENTRY(c6)
    NO_ERROR_CODE_ENTRY(c7)
    NO_ERROR_CODE_ENTRY(c8)
    NO_ERROR_CODE_ENTRY(c9)
    NO_ERROR_CODE_ENTRY(ca)
    NO_ERROR_CODE_ENTRY(cb)
    NO_ERROR_CODE_ENTRY(cc)
    NO_ERROR_CODE_ENTRY(cd)
    NO_ERROR_CODE_ENTRY(ce)
    NO_ERROR_CODE_ENTRY(cf)

    NO_ERROR_CODE_ENTRY(d0)
    NO_ERROR_CODE_ENTRY(d1)
    NO_ERROR_CODE_ENTRY(d2)
    NO_ERROR_CODE_ENTRY(d3)
    NO_ERROR_CODE_ENTRY(d4)
    NO_ERROR_CODE_ENTRY(d5)
    NO_ERROR_CODE_ENTRY(d6)
    NO_ERROR_CODE_ENTRY(d7)
    NO_ERROR_CODE_ENTRY(d8)
    NO_ERROR_CODE_ENTRY(d9)
    NO_ERROR_CODE_ENTRY(da)
    NO_ERROR_CODE_ENTRY(db)
    NO_ERROR_CODE_ENTRY(dc)
    NO_ERROR_CODE_ENTRY(dd)
    NO_ERROR_CODE_ENTRY(de)
    NO_ERROR_CODE_ENTRY(df)

    NO_ERROR_CODE_ENTRY(e0)
    NO_ERROR_CODE_ENTRY(e1)
    NO_ERROR_CODE_ENTRY(e2)
    NO_ERROR_CODE_ENTRY(e3)
    NO_ERROR_CODE_ENTRY(e4)
    NO_ERROR_CODE_ENTRY(e5)
    NO_ERROR_CODE_ENTRY(e6)
    NO_ERROR_CODE_ENTRY(e7)
    NO_ERROR_CODE_ENTRY(e8)
    NO_ERROR_CODE_ENTRY(e9)
    NO_ERROR_CODE_ENTRY(ea)
    NO_ERROR_CODE_ENTRY(eb)
    NO_ERROR_CODE_ENTRY(ec)
    NO_ERROR_CODE_ENTRY(ed)
    NO_ERROR_CODE_ENTRY(ee)
    NO_ERROR_CODE_ENTRY(ef)

    NO_ERROR_CODE_ENTRY(f0)
    NO_ERROR_CODE_ENTRY(f1)
    NO_ERROR_CODE_ENTRY(f2)
    NO_ERROR_CODE_ENTRY(f3)
    NO_ERROR_CODE_ENTRY(f4)
    NO_ERROR_CODE_ENTRY(f5)
    NO_ERROR_CODE_ENTRY(f6)
    NO_ERROR_CODE_ENTRY(f7)
    NO_ERROR_CODE_ENTRY(f8)
    NO_ERROR_CODE_ENTRY(f9)
    NO_ERROR_CODE_ENTRY(fa)
    NO_ERROR_CODE_ENTRY(fb)
    NO_ERROR_CODE_ENTRY(fc)
    NO_ERROR_CODE_ENTRY(fd)
    NO_ERROR_CODE_ENTRY(fe)
    NO_ERROR_CODE_ENTRY(ff)